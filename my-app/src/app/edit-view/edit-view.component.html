<div class="container" fxLayout="row" fxLayoutAlign="start stretch">
  
  <!-- Column 1: buttons bar-->
  <div class="column">
    <!-- Button 1: create a new archive -->
    <button (click)="archive()">Create archive</button>

    <!-- Button 2: edit the code/save the changes -->
    <div *ngIf="isCodeSelected===true">
      <div *ngIf="isEditing===false; else elseBlock">
        <button (click)="this.isEditing=true;"> Edit </button>
      </div>

      <ng-template #elseBlock>
        <button (click)="goToReference(myCodeset.type,myCode.value);"> Go Back </button>
        <br>
        <button (click)="save()"> Save changes </button>
      </ng-template>
    </div>

  </div>


  <!-- Column 2: codeset selection -->
  <div class="column"  style="background-color:#fafafa;">
    <h3>Codesets</h3>

    <!-- Display all the codesets available -->
    <table class="table table-striped table-hover">
      <tbody>
        <tr title="Show codes" *ngFor="let docu of documents" (click)="openDocu(event, docu.label)">
          <div *ngIf="isDocumentDefined===true; then thenBlock else elseBlock"></div>
          <ng-template #thenBlock>
            <td [ngClass]="{'row-selected': docu.label===myCodeset.label}">{{ docu.label }}</td>
          </ng-template>
          <ng-template #elseBlock>
              <td>{{ docu.label }}</td>
          </ng-template>
        </tr>
      </tbody>
    </table>
  </div>


  <!-- Column 3: code selection (display all the codes IF a codeset is selected -->
  <div *ngIf="isDocumentDefined===true ">
    <div>
      <h3>Codes</h3>

      <!-- Display all the codes attached to the codeset -->
      <table class="table table-striped table-hover">
        <thead>
          <tr>
            <th scope="col">Value</th>
            <th scope="col">Label</th>
          </tr>
        </thead>
        <tbody>
          <tr title="Show details" *ngFor="let code of myCodeset.code" (click)="openCodeset(event, code)">
            <div *ngIf="isCodeSelected===true; then thenBlock else elseBlock"></div>
            <ng-template #thenBlock>
              <td [ngClass]="{'row-selected': code.value===myCode.value}">{{ code.value }}</td>
              <td [ngClass]="{'row-selected': code.value===myCode.value}">{{ code.label }}</td>
            </ng-template>
            <ng-template #elseBlock>
                <td>{{ code.value }}</td>
                <td>{{ code.label }}</td>
            </ng-template>
          </tr>
        </tbody>
      </table>
    </div>
  </div>


  <!-- Column 4: selected code details IF a code is selected -->
  <div *ngIf="isDocumentDefined===true ">

    <div class="column" style="background-color:#f1f1f1;">
      <h3>Details</h3>
      <h5>Codeset label: {{myCodeset.label}}</h5>
      <h5>Codeset type: {{myCodeset.type}}</h5>
      
      <div *ngIf="isCodeSelected===true ">

        <!-- display inputs IF the user wants to edit -->
        <div *ngIf="isEditing===true; else elseBlock">
          <p>Code label:
            <input [(ngModel)]="codeToBeEdited.label"/>
          </p>
          
          <p>Code value:  
            <input [(ngModel)]="codeToBeEdited.value"/>  
          </p>

          <p>Description: 
            <input [(ngModel)]="codeToBeEdited.description"/>
          </p>
          
          <form class="form-inline">
            <label class="control-label">Status: </label>
            <select class="form-control" id="exampleFormControlSelect1" [(ngModel)]="codeToBeEdited.status" [ngModelOptions]="{standalone: true}">
              <option [ngValue]="true">Valid</option>
              <option [ngValue]="false">Invalid</option>
            </select>
          </form>

          <p>
            Use age:
            <br>
            <span>Not before month:  
              <input type="number" min="0" max="{{codeToBeEdited.use_age.not_after_month}}" [(ngModel)]="codeToBeEdited.use_age.not_before_month"/>
            </span>

            <br>
            <span>Not after month: 
              <input type="number" min="{{codeToBeEdited.use_age.not_before_month}}" [(ngModel)]="codeToBeEdited.use_age.not_after_month"/>          
            </span>
          </p>

          <p>
            Use date:
            <br>
            <span>Not before: 
              <input type="number" min="10000000" max="99999999" [(ngModel)]="codeToBeEdited.use_date.not_before"/> 
            </span>

            <br>
            <span>Not expected before: 
              <input type="number" min="10000000" max="99999999" [(ngModel)]="codeToBeEdited.use_date.not_expected_before"/> 
            </span>

            <br>
            <span>Not after: 
              <input type="number" min="10000000" max="99999999" [(ngModel)]="codeToBeEdited.use_date.not_after"/> 
            </span>

            <br>
            <span>Not expected after:
              <input type="number" min="10000000" max="99999999" [(ngModel)]="codeToBeEdited.use_date.not_expected_after"/>
            </span>
          </p>

          <p>Test age:              
            <input [(ngModel)]="codeToBeEdited.test_age"/>
          </p>

          <p>Concept type:  
            <input [(ngModel)]="codeToBeEdited.concept_type"/> 
          </p>

          <p>References:</p>
          
          <ul class="superList">
            <li>
                <select class="custom-select" #selectCodeset (change)="selectedCodesetUpdate($event, selectCodeset.value)">
                  <option value="" selected></option>
                  <option *ngFor="let docu of documents" value={{docu.label}}>{{docu.label}}</option>
                </select>

                <select class="custom-select" [(ngModel)]="editReferenceCodeValue">
                  <option value="" selected></option>
                  <option *ngFor="let codes of editReferenceCodeset.code" value={{codes.value}}>{{codes.value}}</option>
                </select>

                <button title="add a new reference" (click)="addReference($event)">add</button>
            </li>
            <li *ngFor="let ref of codeToBeEdited.references">

              <button title="remove refenrece" type="button" class="close" style="color:red" (click)="removeReference($event, ref)">
                <span aria-hidden="true">&times;</span>
              </button>

              <label>{{ref.type}} - {{ref.codeValue}}</label>
            </li>
          </ul>
        </div>

        <!-- ELSE just display details -->
        <!-- TODO do not display details which do not have a value -->
        <ng-template #elseBlock>
            <p>Code label: {{myCode.label}}</p>
            <p>Code value: {{myCode.value}}</p>
            <p>Description: {{myCode.description}}</p>
            
            <div *ngIf="myCode.status==true; else elseBlock">
              <p>
                Status: Valid
              </p>
            </div>
            <ng-template #elseBlock>
              <p>
                Status: Invalid
              </p>
            </ng-template>
    
            <p>
              Use age:
              <br>
              <span>Not before month: {{myCode.use_age.not_before_month}}</span>
              <br>
              <span>Not after month: {{myCode.use_age.not_after_month}}</span>
            </p>
    
            <p>
              Use date:
              <br>
              <span>Not before: {{myCode.use_date.not_before}}</span>
              <br>
              <span>Not expected before: {{myCode.use_date.not_expected_before}}</span>
              <br>
              <span>Not after: {{myCode.use_date.not_after}}</span>
              <br>
              <span>Not expected after: {{myCode.use_date.not_expected_after}}</span>
            </p>
    
            <p>Test age: {{myCode.test_age}}</p>
            <p>Concept type: {{myCode.concept_type}}</p>
    
            <p>References:</p>
            <ul class="superList">
              <li *ngFor="let ref of myCode.references">
                  <button type="button" class="btn btn-link btn-sm" (click)="goToReference(ref.type, ref.codeValue)">{{ref.type}} - {{ref.codeValue}}</button>
              </li>
            </ul>
        </ng-template>

      </div>
    </div>
  </div>

</div>